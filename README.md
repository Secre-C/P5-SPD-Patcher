# SPD Patcher
## A tool for creating Spd patches to use with Aemulus.
[.NET 6.0](https://dotnet.microsoft.com/en-us/download/dotnet/6.0) is required to use this program.

## Usage
### Creating an Spd Patch
To use, simply drag a .spd file onto the programs .exe. You'll be asked to input the Indexes of the textures you want to make patches for. The index is based on the order shown of the spd's textures in Amicitia or PersonaEditor. The top one is index 1, the one below 2, etc.

![image](https://user-images.githubusercontent.com/89033534/178137613-402569d0-cc80-463e-9151-f3561fd0f82e.png)

You can input multiple indexes, and they should be seperated by spaces.

![image](https://user-images.githubusercontent.com/89033534/178137672-9a9e1b48-fb68-4e8b-bedc-33cc3396fea8.png)

Press enter, and the program will spit out a .spdp file, as well as the .dds texture corresponding with the textures you put in. Open up the .spdp flie in your favorite text editor, and you should see something that resembles binary patches.

```
{
  "Version": 1,
  "Patches": [
    {
      "SpdPath": "p5camp_00SPD.spd",
      "TextureName": "p5camp_03_patch.dds",
      "TextureID": 2,
      "SpriteIDs": "26 66 67 69 84 70 71 72 73 74 77 75 76 78 79 80 82 81 85 89 90 91 92 93 98 99 100 101 102 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 191 192 193 195 201 202 203 204 205 274 275 276 277 278 279 280 281 282 283 285 284 286 465 482 488 490 497 498 503 511 520 521 596 732 753 754 755 766 "
    },
    {
      "SpdPath": "p5camp_00SPD.spd",
      "TextureName": "p5camp_11_patch.dds",
      "TextureID": 6,
      "SpriteIDs": "233 234 235 236 237 238 239 240 654 655 658 707 708 709 710 711 712 713 714 715 716 717 718 719 "
    }
  ]
}
```
"SpdPath" is the path to the .spd in the game's directory, and should be changed immediately, which I'll get to in a second.

"TextureName" is the name of the texture you're going to patch in, and doesn't need to be changed as it should already match the .dds texture that was created by the program.

"Texture ID" is the ID of the texture in the .spd file, and is different from the Index. This doesn't need to be changed as the program should have it set correctly already, but the Texture Ids can be viewed by opening the .spd file in Amicitia.

"SpriteIDs" is a list of all the sprites that use the texture that you entered into the program. I'll go over how to trim the list to what you need later.

The first thing you should do is change the Spd Path field to reflect the .spd's path within the game's files. for this example, ```"p5camp_00SPD.spd"``` should be changed to ```"init\\camp\\p5camp_00SPD.spd"``` Make sure you use double backslashes instead of single ones.

Next, you'll want to trim the sprite ID field to only use the sprite IDs you're changing. For this example, I'm only going to edit the character portraits in texture index 7

![image](https://user-images.githubusercontent.com/89033534/178138060-25ecd1e0-9249-4dac-8b0f-7ffaf56e166c.png)

Here is the .spdp generated by the program for this texture, after editing the SpdPath field
```
{
  "Version": 1,
  "Patches": [
    {
      "SpdPath": "init\\camp\\p5camp_00SPD.spd",
      "TextureName": "p5camp_06_patch.dds",
      "TextureID": 7,
      "SpriteIDs": "49 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 419 491 492 613 614 615 616 617 618 619 620 621 622 623 624 "
    }
  ]
}
```
you'll have to use a combination of PersonaEditor and Amicitia, since there currently isn't a good tool for viewing spd info.

### finding the sprite in PersonaEditor
Open the .spd in PersonaEditor, right click on the spd name in the top right, and click "view/edit". After that, click on the .dds file you want to view from the list in the middle-ish part of the window. You should see something like this.

![image](https://user-images.githubusercontent.com/89033534/178138182-66e6b563-a752-4124-87f0-1c285cb213d9.png)

Start clicking through the sprite entries on the bottom of the window, and take note of which entries light up the parts of the image you want to edit. Now for the hard part.

### finding the sprite in Amicitia
Open the .spd in Amicitia, extend the "sprites" field, and try to find the names of the sprites you found in PersonaEditor. This shouldn't be too difficult since you have all the relevant sprite IDs already in your .spdp file, so use that to narrow down where the sprites would be. When you click on a sprite, ignore the index of the sprite, and take note of the ID on the top right of your Amicitia Window.

In my case, I searched for ID 252, and found it at sprite index 245. 

![image](https://user-images.githubusercontent.com/89033534/178138412-2bf65ae6-4b5f-42eb-9769-196b9c7f004c.png)

Here's what my .spdp patch looks like after removing all the Sprite IDs I didn't want to keep.
```
{
  "Version": 1,
  "Patches": [
    {
      "SpdPath": "init\\camp\\p5camp_00SPD.spd",
      "TextureName": "p5camp_06_patch.dds",
      "TextureID": 7,
      "SpriteIDs": "252 253 254 255 256 257 258 259 613 614 615 616 617 618"
    }
  ]
}
```
After all that is done, feel free to edit the output .dds texture however you'd like!

### Putting into an Aemulus mod
Create or open a mod, and in the root of the mod folder, create a folder called "spdpatches". You can technically put all of your .dds textures and .spdp files in there, but for organizations sake, it's better to put them into another folder inside the spdpatches folder (make sure the .spdp and corresponding .dds files are in the same folder!). After that, all you need to do is press build.

After it's done building, open your mod output folder in your game's USRDIR folder, open the .pac/.spd file in PersonaEditor, and open the view/edit tab like we did before. Click on the .dds file we looked at earlier, and if everything has been done correctly, you should notice that the boxes around the sprites we wanted to edit are gone!

![image](https://user-images.githubusercontent.com/89033534/178139045-870c2473-a3f0-40f7-8023-ed8940d2bb0a.png)

Now scroll down to the bottom of the texture list, and you'll see that there's a texture at the bottom with the same name. Click on it, and the boxes should be around the parts of the texture that we wanted.

![image](https://user-images.githubusercontent.com/89033534/178139046-493be98a-f2d0-4f4e-9620-ee25832ef3f0.png)
